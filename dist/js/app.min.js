function makeTree(a,b){b.droppable(funcDroppableFalse);var c,d,e=a.data("id"),f=++idCode,g=new Tree;if(b.removeClass("ultimo-e"),b.data("id")?(d=b.data("father"),c=b.data("pos")):(c=0,d=0),a.addClass("card2"),a.removeClass("card"),a.draggable({appendTo:"body",cursor:"move",revert:"invalid",greedy:!0}),a.attr("data-id",f),g.id=f,"var"==e)g.tag="<mn>"+a.data("content")+"</mn>";else if("cons"==e)g.tag="<mn>"+a.data("content")+"</mn>";else if("llaves"==e||"parentesis"==e||"corchetes"==e||"factorial"==e){var h=a.find("code:nth-child(1)");h.attr("data-id",++idCode),h.attr("data-pos",0),h.attr("data-father",f),h.addClass("ultimo-e"),"llaves"==e?(g.opentag="<mrow><mtext>{</mtext>",g.closetag="<mtext>}</mtext></mrow>"):"parentesis"==e?(g.opentag="<mrow><mtext>(</mtext>",g.closetag="<mtext>)</mtext></mrow>"):"corchetes"==e?(g.opentag="<mrow><mtext>[</mtext>",g.closetag="<mtext>]</mtext></mrow>"):(g.opentag="<mrow><mtext>(</mtext>",g.tag="",g.closetag="<mtext>)!</mtext></mrow>"),g.setChildren(["<mi>□</mi>"])}else if("trig"==e){var h=a.find("code:nth-child(1)");h.attr("data-id",++idCode),h.attr("data-pos",0),h.attr("data-father",f),h.addClass("ultimo-e"),g.opentag="<mrow><mi>"+a.data("content")+"</mi><mtext>(</mtext>",g.closetag="<mtext>)</mtext></mrow>",g.setChildren(["<mi>□</mi>"])}else if("raiz"==e){var h=a.find("code:nth-child(1)");h.attr("data-id",++idCode),h.attr("data-pos",0),h.attr("data-father",f),h.addClass("ultimo-e"),g.opentag="<mrow><msqrt><mtext>(</mtext>",g.closetag="</msqrt><mtext>)</mtext></mrow>",g.setChildren(["<mi>□</mi>"])}else if("raiz-n"==e){var i=a.find("code:nth-child(1)");i.attr("data-id",++idCode),i.attr("data-pos",1),i.attr("data-father",f),i.addClass("ultimo-e");var j=a.find("code:nth-child(3)");j.attr("data-id",++idCode),j.attr("data-pos",0),j.attr("data-father",f),j.addClass("ultimo-e"),g.opentag="<mrow><mroot>",g.closetag="</mroot></mrow>",g.setChildren(["<mrow><mi>□</mi></mrow>","<mrow><mi>□</mi></mrow>"])}else if("expo"==e||"expo-base"==e){var i=a.find("code:nth-child(1)");i.attr("data-id",++idCode),i.attr("data-pos",0),i.attr("data-father",f),i.addClass("ultimo-e");var j=a.find("code:nth-child(2)");j.attr("data-id",++idCode),j.attr("data-pos",1),j.attr("data-father",f),j.addClass("ultimo-e"),"expo"==e?(g.opentag="<mrow><msup>",g.closetag="</msup></mrow>"):(g.opentag="<mrow><msub>",g.closetag="</msub></mrow>"),g.setChildren(["<mrow><mi>□</mi></mrow>","<mrow><mi>□</mi></mrow>"])}else if("log"==e){var i=a.find("code:nth-child(1)");i.attr("data-id",++idCode),i.attr("data-pos",0),i.attr("data-father",f),i.addClass("ultimo-e");var j=a.find("code:nth-child(2)");j.attr("data-id",++idCode),j.attr("data-pos",1),j.attr("data-father",f),j.addClass("ultimo-e"),g.opentag="<mrow><mi>"+a.data("content")+"</mi><msub>",g.closetag="</msub></mrow>",g.setChildren(["<mrow><mi>□</mi></mrow>","<mrow><mi>□</mi></mrow>"])}else if("suma"==e||"resta"==e||"mult"==e||"igual"==e){var i=a.find("code:nth-child(1)");i.attr("data-id",++idCode),i.attr("data-pos",0),i.attr("data-father",f),i.addClass("ultimo-e");var j=a.find("code:nth-child(2)");j.attr("data-id",++idCode),j.attr("data-pos",2),j.attr("data-father",f),j.addClass("ultimo-e"),g.opentag="<mrow><mtext>(</mtext>",g.closetag="<mtext>)</mtext></mrow>",g.setChildren(["<mrow><mi>□</mi></mrow>","<mo>"+a.data("content")+"</mo>","<mrow><mi>□</mi></mrow>"])}else if("funcionf"==e){var i=a.find("code:nth-child(1)");i.attr("data-id",++idCode),i.attr("data-pos",0),i.attr("data-father",f),i.addClass("ultimo-e");var j=a.find("code:nth-child(2)");j.attr("data-id",++idCode),j.attr("data-pos",2),j.attr("data-father",f),j.addClass("ultimo-e"),g.opentag="<mrow><mtext>f(</mtext>",g.closetag="</mrow>",g.setChildren(["<mrow><mi>□</mi></mrow>","<mo>)=</mo>","<mrow><mi>□</mi></mrow>"])}else if("combinatoria"==e){var i=a.find("div:nth-child(2)").find("div:nth-child(1)");i.attr("data-id",++idCode),i.attr("data-pos",0),i.attr("data-father",f),i.addClass("ultimo-e");var j=a.find("div:nth-child(2)").find("div:nth-child(2)");j.attr("data-id",++idCode),j.attr("data-pos",1),j.attr("data-father",f),j.addClass("ultimo-e"),g.opentag="<mrow><mtext>(</mtext><mfrac linethickness='0em'>",g.closetag="</mfrac><mtext>)</mtext></mrow>",g.setChildren(["<mrow><mi>□</mi></mrow>","<mrow><mi>□</mi></mrow>"])}else if("division"==e){var i=a.find("div:nth-child(2)").find("div:nth-child(1)");i.attr("data-id",++idCode),i.attr("data-pos",0),i.attr("data-father",f),i.addClass("ultimo-e");var j=a.find("div:nth-child(2)").find("div:nth-child(3)");j.attr("data-id",++idCode),j.attr("data-pos",1),j.attr("data-father",f),j.addClass("ultimo-e"),g.opentag="<mrow><mtext>(</mtext><mfrac linethickness='1px'>",g.closetag="</mfrac><mtext>)</mtext></mrow>",g.setChildren(["<mrow><mi>□</mi></mrow>","<mrow><mi>□</mi></mrow>"])}else if("sumatoria"==e||"integral"==e||"multiplicatoria"==e){var i=a.find("div:nth-child(3)").find("div:nth-child(2)");i.attr("data-id",++idCode),i.attr("data-pos",0),i.attr("data-father",f),i.addClass("ultimo-e");var j=a.find("div:nth-child(3)").find("div:nth-child(1)");j.attr("data-id",++idCode),j.attr("data-pos",1),j.attr("data-father",f),j.addClass("ultimo-e");var k=a.find("code");k.attr("data-id",++idCode),k.attr("data-pos",3),k.attr("data-father",f),k.addClass("ultimo-e");var l;"sumatoria"==e?l="<mo>&#x2211;</mo>":"integral"==e?l="<mo>&#x222B;</mo>":"multiplicatoria"==e&&(l="<mo>&#x220F;</mo>"),g.opentag="<mrow><munderover>"+l,g.closetag="</mrow>",g.setChildren(["<mrow><mi>□</mi></mrow>","<mrow><mi>□</mi></mrow>","</munderover>","<mrow><mi>□</mi></mrow>"])}else if("func-2"==e||"func-3"==e||"func-4"==e||"func-5"==e){for(var m=e.substring(e.lastIndexOf("-")+1),n=[],o=0;m>o;o++){var p="code:nth-child("+(o+1)+")",h=a.find(p);h.attr("data-id",++idCode),h.attr("data-pos",0),h.attr("data-father",f),h.addClass("ultimo-e"),n[o]="<mrow><mi>□</mi></mrow>"}g.opentag="<mrow><mtext>(</mtext>",g.closetag="<mtext>)</mtext></mrow>",g.setChildren(n)}treeActual.addNode(d,g,c);var q=a.find(".spa");q.addClass("drop2"),q.droppable(funcDroppable)}function Tree(){this.id="",this.tag="",this.opentag="",this.closetag="",this.children=[],this.meta=[]}function makeStringRec(a){var b="";if(a instanceof Tree){if(a.opentag&&(b=a.opentag),a.tag&&(b+=a.tag),a.children&&a.children.length>0)for(var c in a.children){var d=a.children[c];b+=makeStringRec(d)}a.closetag&&(b+=a.closetag)}else for(var c in a)b+=a[c];return b}function addNodeRec(a,b,c){if(a.id===b)endFunction=!0,c(a);else if(!endFunction)if(a.children)if(a.children.length>0)for(var d in a.children){var e=a.children[d];addNodeRec(e,b,c)}else c(null,"no se encontro el id");else c(null,"no se encontraron hijos")}function removeNodeRec(a,b,c){if(a instanceof Tree)if(a.id==b)endFunction=!0,c(a);else if(!endFunction)if(a.children)if(a.children.length>0)for(var d in a.children){var e=a.children[d];addNodeRec(e,b,c)}else c(null,"no se encontro el id");else c(null,"no se encontraron hijos")}function rebootTree(){first=!0,$(".drop").droppable(funcDroppableDrop),idCode=0,treeActual=new Tree,treeActual.id=0}function Variable(){this.name="",this.type="",this.cifras="",this.value={},this.numb=[]}function varToXML(){var a="<variables>";if(conjuntoVariables.length>0){for(var b in conjuntoVariables){var c,d=conjuntoVariables[b];if("espcifica"==d.type)c="<variable tipo="+d.type+" id="+d.name+">",c=c+"<valor>"+d.numb[0]+"</valor></variable>";else if("discreta"==d.type){c="<variable tipo="+d.type+" id="+d.name+">";for(var e in d.numb)c=c+"<valor>"+d.numb[e]+"</valor>";c+="</variable>"}else if("categorica"==d.type){c="<variable tipo="+d.type+" id="+d.name+">";for(var e in d.numb)c=c+"<valor>"+d.numb[e]+"</valor>";c+="</variable>"}else"normal"==d.type?(c="<variable tipo="+d.type+" cifras_decimales="+d.cifras+" id="+d.name+">",c=c+"<media>"+d.value.media+"</media>",c=c+"<desviacion>"+d.value.desviacion+"</desviacion></variable>"):"uniforme"==d.type?(c="<variable tipo="+d.type+" cifras_decimales="+d.cifras+" id="+d.name+">",c=c+"<inicio>"+d.value.inicio+"</fin>",c=c+"<fin>"+d.value.fin+"</fin></variable>"):"exponencial"==d.type&&(c="<variable tipo="+d.type+" cifras_decimales="+d.cifras+" id="+d.name+">",c=c+"<lamda>"+d.value.lamda+"</lamda></variable>");a+=c}a+="</variables>"}}function setEndOfContenteditable(a){var b,c;document.createRange?(b=document.createRange(),b.selectNodeContents(a),b.collapse(!1),c=window.getSelection(),c.removeAllRanges(),c.addRange(b)):document.selection&&(b=document.body.createTextRange(),b.moveToElementText(a),b.collapse(!1),b.select())}var idCode=0,first=!0,endFunction=!1,treeActual=new Tree;$(function(){$(".card").draggable({appendTo:"body",cursor:"move",helper:"clone",revert:"invalid",drag:function(){}})}),$(function(){$("#droppable-out").droppable(funcDroppableOut),$(".drop").droppable(funcDroppableDrop)});var funcDroppableOut={tolerance:"intersect",accept:".card2",drop:function(a,b){var c=$(b.draggable);if(c.hasClass("first"))rebootTree(),UpdateMath("<math></math>");else{var d=c.parent();d.addClass("ultimo-e");var e=d.data("father"),f=d.data("pos"),g=$("div").find("[data-id="+e+"]"),h=g.find(".spa");h.addClass("drop2"),h.droppable(funcDroppable),treeActual.removeNode(e,f);var i=treeActual.makeString();UpdateMath("<math>"+i+"</math>")}c.remove()}},funcDroppableDrop={tolerance:"intersect",accept:".card",activeClass:"ui-state-default",hoverClass:"drop-p",drop:function(a,b){var c=$(b.draggable).clone();makeTree(c,$(this)),$(this).append(c);var d=treeActual.makeString();UpdateMath("<math>"+d+"</math>"),console.log("mathml:"),console.log(d),console.log("tree:"),console.log(treeActual),first&&(first=!1,c.addClass("first"))}},funcDroppable={tolerance:"touch",accept:".card",activeClass:"drop-3",hoverClass:function(){return $(this).children().length<1?"drop-2":""},drop:function(a,b){var c=$(b.draggable).clone();makeTree(c,$(this)),$(this).append(c);var d=treeActual.makeString();UpdateMath("<math>"+d+"</math>"),console.log("mathml:"),console.log(d),console.log("tree:"),console.log(treeActual)}},funcDroppableFalse={tolerance:"touch",accept:".naskiajs",activeClass:"aaa3",drop:function(){}};!function(){var a=MathJax.Hub.queue,b=null;a.Push(function(){b=MathJax.Hub.getAllJax("previsualizar")[0]}),window.UpdateMath=function(c){a.Push(["Text",b,c])}}(),Tree.prototype.init=function(a,b,c,d,e){this.id=a,this.tag=b,this.opentag=c,this.closetag=d,this.children=e},Tree.prototype.setChildren=function(a){this.children=a},Tree.prototype.setChildrenPos=function(a,b){console.log("children"),console.log(b),this.children.splice(a,1,b)},Tree.prototype.makeString=function(){var a=makeStringRec(this);return a},Tree.prototype.addNode=function(a,b,c){endFunction=!1,0==this.children.length?this.children=[b]:addNodeRec(this,a,function(a,d){d?console.log(d):a.setChildrenPos(c,b)})},Tree.prototype.removeNode=function(a,b){endFunction=!1,removeNodeRec(this,a,function(a,c){c?console.log(c):a.children[b]="<mi>□</mi>"})};var varn,arrayValues=[];jsonValues={};var conjuntoVariables=[];$(document).ready(function(){function a(){varn=new Variable,arrayValues=[],jsonValues={},$("#formEspecifica").fadeOut("fast"),$("#formDiscreta").fadeOut("fast"),$("#formCategorica").fadeOut("fast"),$("#formNormal").fadeOut("fast"),$("#formUniforme").fadeOut("fast"),$("#formExponencial").fadeOut("fast")}$("#rootwizard").bootstrapWizard(),$("#valor").rating(),$("#valorA").rating(),$("#varEspecifica").click(function(){a(),$("#formEspecifica").fadeIn()}),$("#varDiscreta").click(function(){a(),$("#formDiscreta").fadeIn()}),$("#varCategorica").click(function(){a(),$("#formCategorica").fadeIn()}),$("#varNormal").click(function(){a(),$("#formNormal").fadeIn()}),$("#varUniforme").click(function(){a(),$("#formUniforme").fadeIn()}),$("#varExponencial").click(function(){a(),$("#formExponencial").fadeIn()}),$("#ag-varEspcifica").click(function(){var a=$("#nameEsp").val();arrayValues=[$("#valorEsp").val()],varn.name=a,varn.type="espcifica",$("#outFormEspecifica").text(a+"= ["+arrayValues+"]"),$("#endVar").show()}),$("#ag-varDiscreta").click(function(){console.log("NEAa");var a=$("#nameDis").val();arrayValues.splice(arrayValues.length,0,[$("#valorDis").val()]),varn.name=a,varn.type="discreta",$("#outFormDiscreta").text(a+"= ["+arrayValues+"]"),$("#endVar").show()}),$("#ag-varCategorica").click(function(){var a=$("#nameCat").val();arrayValues.splice(arrayValues.length,0,[$("#valorCat").val()]),varn.name=a,varn.type="categorica",$("#outFormCategorica").text(a+"= ["+arrayValues+"]"),$("#endVar").show()}),$("#ag-varNormal").click(function(){var a=$("#nameNor").val(),b=$("#normalNor").val(),c=$("#desviacionNor").val();varn.name=a,varn.type="normal",jsonValues.media=b,jsonValues.desviacion=c,$("#outFormNormal").text(a+"= [µ="+b+", σ="+c+"]"),$("#endVar").show()}),$("#ag-varUniforme").click(function(){var a=$("#nameUni").val(),b=$("#valueaUni").val(),c=$("#valuebUni").val();varn.name=a,varn.type="uniforme",jsonValues.inicio=b,jsonValues.fin=c,$("#outFormUniforme").text(a+"= [a="+b+", b="+c+"]"),$("#endVar").show()}),$("#ag-varExponencial").click(function(){console.log("..");var a=$("#nameUni").val(),b=$("#valueUni").val();varn.name=a,varn.type="exponencial",jsonValues.lamda=b,$("#outFormExponencial").text(a+"= [λ="+b+"]"),$("#endVar").show()}),$("#endVar").click(function(){varn.value=jsonValues,varn.numb=arrayValues,console.log(varn.value),$("#panel-variables").append('<div class="card"><span class="var">'+varn.name+"</span></div>"),conjuntoVariables.splice(conjuntoVariables.length,0,varn)})}),$(document).ready(function(){var a=document.getElementById("eq");setEndOfContenteditable(a)});
